```{r}
#load all files from GitHub

library(httr)
library(jsonlite)
library(purrr)
library(sf)

# GitHub API URL voor de map met de branch
api_url <- "https://api.github.com/repos/b-cubed-eu/WP6_use_case_Flanders/contents/data/output/general_indicators?ref=b3gbi_indicators"

# API request
resp <- GET(api_url)
stop_for_status(resp) # stop als request faalt

# Parse JSON
content <- content(resp, "parsed")

# Filter alleen GeoJSON bestanden
geo_files <- keep(content, ~ .x$type == "file" && grepl("\\.geojson$", .x$name))
file_names <- map_chr(geo_files, "name")
download_urls <- map_chr(geo_files, "download_url")

# Functie om GeoJSON in te lezen
read_geojson_url <- function(url) {
  sf_obj <- st_read(url, quiet = TRUE)
  return(sf_obj)
}

# Alle GeoJSONs inlezen in een lijst
geo_list <- map(download_urls, read_geojson_url)
names(geo_list) <- file_names

# Optioneel: combineer alles in 1 sf-object met indicator-naam
geo_combined <- do.call(rbind,
                        map2(geo_list, file_names, ~ dplyr::mutate(.x, indicator_name = .y)))
```

